<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Profile - Islamic Online</title>
  <!-- Bootstrap 5 CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <!-- Animate.css for animations -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
  />
  <style>
    /* Global Styles */
    body {
      background: url('https://source.unsplash.com/random/1920x1080') no-repeat center center/cover;
      margin: 0;
      font-family: 'Poppins', sans-serif;
    }
    /* Top Buttons */
    .home-btn, .logout-btn {
      position: fixed;
      top: 20px;
      z-index: 1050;
      padding: 10px 20px;
      border-radius: 5px;
      text-decoration: none;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      transition: background-color 0.3s ease;
      color: #fff;
    }
    .home-btn {
      right: 150px;
      background-color: #28a745;
    }
    .home-btn:hover {
      background-color: #218838;
    }
    .logout-btn {
      right: 20px;
      background-color: #dc3545;
    }
    .logout-btn:hover {
      background-color: #c82333;
    }
    /* Profile Container */
    .profile-container {
      display: flex;
      min-height: 100vh;
    }
    /* Sidebar */
    .sidebar {
      width: 250px;
      background: linear-gradient(135deg, #343a40, #212529);
      color: #fff;
      padding: 30px 15px;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
    }
    .sidebar img {
      width: 130px;
      height: 130px;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid #28a745;
      margin-bottom: 10px;
      transition: transform 0.3s ease;
    }
    .sidebar img:hover {
      transform: scale(1.05);
    }
    /* Three Dots Options */
    .profile-options {
      position: relative;
      margin-bottom: 20px;
      width: 100%;
    }
    .options-btn {
      background: transparent;
      border: none;
      color: #fff;
      font-size: 24px;
      cursor: pointer;
      padding: 0;
    }
    .options-menu {
      display: none;
      position: absolute;
      top: 35px;
      right: 0;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 5px;
      min-width: 200px;
      z-index: 1100;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      overflow: visible;
    }
    .options-menu button {
      width: 100%;
      background: none;
      border: none;
      padding: 10px 15px;
      text-align: left;
      color: #212529;
      cursor: pointer;
      white-space: normal;
    }
    .options-menu button:hover {
      background-color: #f8f9fa;
    }
    /* Unit Container */
    .unit-container {
      width: 100%;
      margin-top: 20px;
    }
    .unit {
      background-color: #28a745; /* Default for Unit One */
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 10px;
      text-align: center;
      cursor: pointer;
      transition: background-color 0.3s ease, transform 0.3s ease;
    }
    .unit:hover {
      transform: scale(1.03);
    }
    .unit[data-unit='1'] { background-color: #28a745; }
    .unit[data-unit='2'] { background-color: #17a2b8; }
    .unit[data-unit='3'] { background-color: #ffc107; color: #212529; }
    .unit[data-unit='4'] { background-color: #dc3545; }
    /* Main Content */
    .main-content {
      flex: 1;
      padding: 40px;
      background: #e9ecef;
      overflow-y: auto;
    }
    .form-container {
      max-width: 800px;
      margin: 0 auto;
      background: #fff;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
      text-align: center;
    }
    .form-container h2 {
      margin-bottom: 20px;
      font-weight: 700;
      color: #343a40;
    }
    .form-container h3 {
      margin-bottom: 30px;
      font-weight: 600;
      color: #007bff;
    }
    .exam-btn {
      padding: 15px;
      border-radius: 10px;
      font-size: 1.2rem;
      font-weight: bold;
      width: 100%;
      display: block;
      margin-bottom: 15px;
      cursor: pointer;
      border: none;
      color: #fff;
      transition: transform 0.3s ease, background-color 0.3s ease;
    }
    .exam-btn:hover {
      transform: scale(1.03);
    }
    .exam-btn[data-unit='1'] { background-color: #28a745; }
    .exam-btn[data-unit='2'] { background-color: #17a2b8; }
    .exam-btn[data-unit='3'] { background-color: #ffc107; color: #212529; }
    .exam-btn[data-unit='4'] { background-color: #dc3545; }
    /* Footer */
    footer {
      background-color: #0056b3;
      color: #fff;
      text-align: center;
      padding: 15px 10px;
      position: relative;
      width: 100%;
    }
    /* Responsive Design */
    @media (max-width: 992px) {
      .profile-container {
        flex-direction: column;
      }
      .sidebar {
        width: 100%;
        flex-direction: row;
        justify-content: space-around;
        padding: 20px;
      }
      .sidebar img {
        width: 80px;
        height: 80px;
        border: 3px solid #28a745;
      }
      .unit-container {
        display: none;
      }
      .main-content {
        padding: 20px;
      }
    }
    /* Increase font size and bold text for input fields */
    .form-control {
      background: rgba(255, 255, 255, 0.25);
      border: none;
      border-radius: 10px;
      padding: 12px 15px;
      color: #fff;
      font-size: 18px;
      font-weight: bold;
      transition: all 0.3s ease;
    }
    .form-control::placeholder {
      color: #e0e0e0;
      font-style: italic;
    }
    .form-control:focus {
      background: rgba(255, 255, 255, 0.35);
      box-shadow: 0 0 5px rgba(255, 255, 255, 0.8);
      color: #fff;
    }
    /* Custom styles for code input fields in modals */
    #unitCodeInput, #examCodeInput {
      background-color: #007bff; /* Blue background */
      color: #000; /* Black text */
    }
  </style>
</head>
<body>
  <!-- Top Buttons -->
  <a href="/" class="home-btn animate__animated animate__fadeInDown">Home</a>
  <a href="/login" class="logout-btn animate__animated animate__fadeInDown" onclick="logout()">Logout</a>
  
  <div class="profile-container">
    <!-- Sidebar -->
    <div class="sidebar animate__animated animate__fadeInLeft">
      <img src="/static/logo.jpeg" alt="Logo Picture" />
      <!-- Three Dots Options -->
      <div class="profile-options">
        <button class="options-btn" onclick="toggleOptionsMenu()">&#8942;</button>
        <div class="options-menu">
          <button onclick="openChangePasswordModal()">Change Password</button>
          <button onclick="logout()">Logout</button>
        </div>
      </div>

      <div class="unit-container">
        <div class="unit" data-unit="1" onclick="showUnitCodeModal('unit1')">Unit One</div>
        <div class="unit disabled" data-unit="2" onclick="showUnitCodeModal('unit2')">Unit Two</div>
        <div class="unit disabled" data-unit="3" onclick="showUnitCodeModal('unit3')">Unit Three</div>
        <div class="unit disabled" data-unit="4" onclick="showUnitCodeModal('unit4')">Unit Four</div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content animate__animated animate__fadeInRight">
      <div class="form-container">
        <div class="main-content animate__animated animate__fadeInRight">
          <h2>Welcome to Student Lessons</h2>
        </div>
        <h3>Final Exams</h3>
        <button class="exam-btn disabled-exam" data-unit="1" onclick="showExamCodeModal('unit1')">Unit One Final Exam</button>
        <button class="exam-btn disabled-exam" data-unit="2" onclick="showExamCodeModal('unit2')">Unit Two Final Exam</button>
        <button class="exam-btn disabled-exam" data-unit="3" onclick="showExamCodeModal('unit3')">Unit Three Final Exam</button>
        <button class="exam-btn disabled-exam" data-unit="4" onclick="showExamCodeModal('unit4')">Unit Four Final Exam</button>
      </div>
    </div>
  </div>
  
  <!-- Footer -->
  <footer class="animate__animated animate__fadeInUp">
    <p>&copy; 2025 Islamic Online. All rights reserved.</p>
  </footer>

  <!-- Unit Code Modal -->
  <div class="modal fade" id="unitCodeModal" tabindex="-1" aria-labelledby="unitCodeModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="unitCodeModalLabel">Enter Unit Code</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <input type="text" id="unitCodeInput" class="form-control" placeholder="Enter unit code" />
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" onclick="submitUnitCode()">Submit</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Exam Code Modal -->
  <div class="modal fade" id="examCodeModal" tabindex="-1" aria-labelledby="examCodeModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="examCodeModalLabel">Enter Exam Code</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <input type="text" id="examCodeInput" class="form-control" placeholder="Enter exam code" />
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" onclick="submitExamCode()">Submit</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script>
    // Predefined codes (update these values as needed)
    const unitCodes = {
      'unit1': '1234',
      'unit2': '2345',
      'unit3': '3456',
      'unit4': '4567'
    };
    const examCodes = {
      'unit1': 'abcd',
      'unit2': 'bcde',
      'unit3': 'cdef',
      'unit4': 'defg'
    };

    let currentUnitId = '';
    let currentExamId = '';

    // Modified: Check if unit code was already entered correctly.
    function showUnitCodeModal(unitId) {
      let completedUnitCodes = JSON.parse(localStorage.getItem('completedUnitCodes')) || {};
      if(completedUnitCodes[unitId]) {
        // Already entered code – navigate directly.
        window.location.href = `/${unitId}`;
      } else {
        currentUnitId = unitId;
        const modal = new bootstrap.Modal(document.getElementById('unitCodeModal'));
        document.getElementById('unitCodeInput').value = '';
        modal.show();
      }
    }

    // Modified: On correct unit code entry, mark as completed.
    function submitUnitCode() {
      const enteredCode = document.getElementById('unitCodeInput').value.trim();
      if(enteredCode === unitCodes[currentUnitId]) {
        let completedUnitCodes = JSON.parse(localStorage.getItem('completedUnitCodes')) || {};
        completedUnitCodes[currentUnitId] = true;
        localStorage.setItem('completedUnitCodes', JSON.stringify(completedUnitCodes));
        window.location.href = `/${currentUnitId}`;
      } else {
        alert('Incorrect unit code. Please try again.');
      }
    }

    // Modified: Check if exam code was already entered correctly.
    function showExamCodeModal(unitId) {
      let completedExamCodes = JSON.parse(localStorage.getItem('completedExamCodes')) || {};
      if(completedExamCodes[unitId]) {
        // Already entered exam code – navigate directly.
        window.location.href = `/${unitId}/final_exam`;
      } else {
        currentExamId = unitId;
        const modal = new bootstrap.Modal(document.getElementById('examCodeModal'));
        document.getElementById('examCodeInput').value = '';
        modal.show();
      }
    }

    // Modified: On correct exam code entry, mark as completed.
    function submitExamCode() {
      const enteredCode = document.getElementById('examCodeInput').value.trim();
      if(enteredCode === examCodes[currentExamId]) {
        let completedExamCodes = JSON.parse(localStorage.getItem('completedExamCodes')) || {};
        completedExamCodes[currentExamId] = true;
        localStorage.setItem('completedExamCodes', JSON.stringify(completedExamCodes));
        window.location.href = `/${currentExamId}/final_exam`;
      } else {
        alert('Incorrect exam code. Please try again.');
      }
    }

    function toggleOptionsMenu() {
      const menu = document.querySelector('.options-menu');
      menu.style.display = (menu.style.display === 'block') ? 'none' : 'block';
    }

    // Hide options menu when clicking outside
    document.addEventListener('click', function(event) {
      const profileOptions = document.querySelector('.profile-options');
      if (!profileOptions.contains(event.target)) {
        document.querySelector('.options-menu').style.display = 'none';
      }
    });

    function openChangePasswordModal() {
      document.querySelector('.options-menu').style.display = 'none';
      // Implement your change password modal logic here
      alert('Change Password modal would open here.');
    }

    function logout() {
      document.querySelector('.options-menu').style.display = 'none';
      if(confirm('Are you sure you want to logout?')) {
        window.location.href = '/login';
      }
    }

    // Modified: Enable unit and exam buttons based on localStorage flags.
    document.addEventListener("DOMContentLoaded", function () {
      let completedUnitCodes = JSON.parse(localStorage.getItem('completedUnitCodes')) || {};
      let completedExamCodes = JSON.parse(localStorage.getItem('completedExamCodes')) || {};
      // Enable Unit One by default
      document.querySelector(".unit[data-unit='1']").classList.remove("disabled");
      let units = document.querySelectorAll(".unit");
      let examButtons = document.querySelectorAll(".exam-btn");
      units.forEach((unit, index) => {
        let unitKey = `unit${index + 1}`;
        if (completedUnitCodes[unitKey]) {
          unit.classList.remove("disabled");
        }
      });
      examButtons.forEach((button, index) => {
        let unitKey = `unit${index + 1}`;
        if (completedExamCodes[unitKey]) {
          button.classList.remove("disabled-exam");
        }
      });
    });
  </script>
  <!-- Bootstrap JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
